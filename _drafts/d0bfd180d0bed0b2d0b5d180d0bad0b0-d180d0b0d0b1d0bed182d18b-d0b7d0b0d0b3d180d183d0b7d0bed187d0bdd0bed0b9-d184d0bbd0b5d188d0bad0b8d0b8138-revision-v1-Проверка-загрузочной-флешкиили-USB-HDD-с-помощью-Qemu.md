---
id: 140
title: 'Проверка загрузочной флешки(или USB-HDD) с помощью Qemu'
date: '2012-11-28T16:58:37+02:00'
author: 'Андрей Гуцу'
layout: revision
guid: 'http://blog.lordofgale.org/2012/11/138-revision/'
permalink: '/?p=140'
---

<p>Для систем на базе x86 вы можете использовать команду:</p>
<pre>
<code class="bash">
sudo qemu-system-i386 -boot c -drive file=< наше устройство в каталоге /dev/>,cache=none -m 256
</code>
</pre>
<p>Стоит заметить, что раньше для запуска qemu с эмуляцией архитектуры x86 я мог просто набрать qemu вместо qemu-system-i386, но в Ubuntu 12.10 нет символической ссылки с qemu на  qemu-system-i386, так что нужно набирать длинное название исполняемого файла.</p>

<p>Для ОС архитектуры x86_64, загружаемых с нашего устройства:</p>
<pre>
<code class="bash">
sudo qemu-system-x86_64 -boot c -drive file=< наше устройство в каталоге /dev/>,cache=none -m 256
</code>
</pre>
<p>Вместо команды <i>qemu-system-< архитектура></i> можно использовать команду <i>kvm</i>(если у вас установлена виртуальная машина kvm). KVM работает заметно быстрее, чем Qemu. Но не поддерживает эмуляцию архитектур, отличных от архитектуры хоста(компьютера, на котором вы запускаете виртуальную машину), и требует поддержки аппаратной виртуализации вашим процессором. Если kvm не работает на вашем компьютере, ничего страшного. Используйте Qemu.</p>

<p>Параметр <i>boot c</i> говорит нашей виртуальной машине, что загрузка должна начинаться с жёсткого диска.</p>

<p>Параметр <i>-drive file=< наше устройство в каталоге /dev/>,cache=none</i> указывает, что в роли дискового устройства будет использован файл из каталога <i>/dev/</i>(как вы догадались, это наше дисковое устройство(флешка или винт), которое мы хотим загрузить в виртуальной машине). Обратите внимание на <i>cache=none</i>. Мы запрещаем виртуальной машине кешировать файлы с дискового устройства с которого производим загрузку. Кеширование в нашем случае должно быть отключено, иначе на этапе редактирования конфигурации загрузчика вы не будете понимать, почему в виртуальной машине постоянно загружается старая версия конфигурации. Я как-то очень нервничал из-за того, что Qemu не замечал изменения в grub.cfg, и загружал мне целый час grub.cfg, в котором был только пункт Halt.

</p><p>На десерт я оставляю вам скриншот, демонстрирующий приглашение свежеустановленного на flash-брелок (вы же помните, как установить GRUB2 на флешку) загрузчика, загруженного в виртуальной машине Qemu:</p>
<a href="http://blog.lordofgale.org/wp-content/uploads/2012/11/Screenshot-from-2012-11-28-163342.png"><img src="http://blog.lordofgale.org/wp-content/uploads/2012/11/Screenshot-from-2012-11-28-163342-300x187.png" alt="" title="Screenshot from 2012-11-28 16:33:42" width="300" height="187" class="alignleft size-medium wp-image-139" /></a>