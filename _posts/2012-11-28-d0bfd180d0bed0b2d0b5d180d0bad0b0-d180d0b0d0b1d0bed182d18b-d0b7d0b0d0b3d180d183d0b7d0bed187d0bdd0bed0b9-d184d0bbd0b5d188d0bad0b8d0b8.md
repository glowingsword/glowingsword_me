---
id: 138
title: 'Проверка работы загрузочной флешки(или USB-HDD) с помощью виртуальной машины Qemu'
date: '2012-11-28T16:59:14+02:00'
author: 'Андрей Гуцу'
layout: post
guid: 'http://blog.lordofgale.org/?p=138'
permalink: /%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%ba%d0%b0-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b-%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%be%d1%87%d0%bd%d0%be%d0%b9-%d1%84%d0%bb%d0%b5%d1%88%d0%ba%d0%b8%d0%b8/
categories:
    - linux
    - 'создание загрузочной флешки'
tags:
    - grub2
    - qemu
    - 'загрузочная флешка'
---

<p>Для загрузки систем на базе x86 вы можете использовать команду:</p>
<pre>
<code class="bash">
sudo qemu-system-i386 -boot c -drive file=< наше устройство в каталоге /dev/>,cache=none -m 256
</code>
</pre>
<p>Стоит заметить, что раньше для запуска qemu с эмуляцией архитектуры x86 я мог просто набрать qemu вместо qemu-system-i386, но в Ubuntu 12.10 нет символической ссылки с qemu на  qemu-system-i386, так что нужно набирать длинное название исполняемого файла.</p>

<p>Для ОС архитектуры x86_64, загружаемых с нашего устройства:</p>
<pre>
<code class="bash">
sudo qemu-system-x86_64 -boot c -drive file=< наше устройство в каталоге /dev/>,cache=none -m 256
</code>
</pre>
<p>Вместо команды <i>qemu-system-< архитектура></i> можно использовать команду <i>kvm</i>(если у вас установлена виртуальная машина kvm). KVM работает заметно быстрее, чем Qemu. Но не поддерживает эмуляцию архитектур, отличных от архитектуры хоста(компьютера, на котором вы запускаете виртуальную машину), и требует поддержки аппаратной виртуализации вашим процессором. Если kvm не работает на вашем компьютере, ничего страшного. Используйте Qemu.</p>

<p>Параметр <i>boot c</i> говорит нашей виртуальной машине, что загрузка должна начинаться с жёсткого диска.</p>

<p>Параметр <i>-drive file=< наше устройство в каталоге /dev/>,cache=none</i> указывает, что в роли дискового устройства будет использован файл из каталога <i>/dev/</i>(как вы догадались, это наше дисковое устройство(флешка или винт), которое мы хотим загрузить в виртуальной машине). Обратите внимание на <i>cache=none</i>. Мы запрещаем виртуальной машине кешировать файлы с дискового устройства с которого производим загрузку. Кеширование в нашем случае должно быть отключено, иначе на этапе редактирования конфигурации загрузчика вы не будете понимать, почему в виртуальной машине постоянно загружается старая версия конфигурации. Я как-то очень нервничал из-за того, что Qemu не замечал изменения в grub.cfg, и загружал мне целый час grub.cfg, в котором был только пункт Halt.
</p>
<p> Параметр <i>-m 256</i> выделяет 256 мегабайт оперативной памяти нашей виртуальной машине. Если вы хотите протестировать загрузку Windows 8 или Ubuntu Linux, советую выставить хотя-бы 512 мегабайти, но для проверки работоспособности загрузчика даже 256 мегабайт будет очень много:)</p>
<p>На десерт я оставляю вам скриншот, демонстрирующий приглашение свежеустановленного на flash-брелок (вы же помните, как установить GRUB2 на флешку) загрузчика, загруженного в виртуальной машине Qemu:</p>
<a href="https://glowingsword.ru/wp-content/uploads/2012/11/Screenshot-from-2012-11-28-163342.png"><img src="https://glowingsword.ru/wp-content/uploads/2012/11/Screenshot-from-2012-11-28-163342-300x187.png" alt="" title="Screenshot from 2012-11-28 16:33:42" width="300" height="187" class="alignleft size-medium wp-image-139" /></a>